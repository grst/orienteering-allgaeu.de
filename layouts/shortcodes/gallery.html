{{- $gallery := .Get "gallery" | default "default" -}}
{{- $images := .Get "images" -}}
{{- $path := .Get "path" | default "/img/posts/" -}}

{{- if not $images -}}
    <p class="alert alert-warning">Keine Bilder für die Galerie angegeben.</p>
{{- else -}}
    {{- $imageList := split $images "," -}}
    
<!-- Gallery Container -->
<div class="gallery-container" id="gallery-{{ $gallery }}">
    <div class="row">
        {{- range $index, $image := $imageList -}}
        {{- $image := trim $image " " -}}
        <div class="col-md-4 col-sm-6 col-xs-12 gallery-item">
            <div class="gallery-image-wrapper">
                <img src="{{ printf "%s%s" $path $image | relURL }}" 
                     alt="Galerie Bild {{ add $index 1 }}"
                     class="gallery-image img-responsive"
                     data-toggle="modal" 
                     data-target="#imageModal-{{ $gallery }}"
                     data-image-src="{{ printf "%s%s" $path $image | relURL }}"
                     data-image-index="{{ $index }}">
            </div>
        </div>
        {{- end -}}
    </div>
</div>

<!-- Modal for full size images -->
<div class="modal fade" id="imageModal-{{ $gallery }}" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Galerie</h4>
            </div>
            <div class="modal-body text-center">
                <img id="modalImage-{{ $gallery }}" src="" class="img-responsive center-block" alt="Vergrößertes Bild">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" id="prevBtn-{{ $gallery }}">← Vorheriges</button>
                <button type="button" class="btn btn-default" id="nextBtn-{{ $gallery }}">Nächstes →</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Schließen</button>
            </div>
        </div>
    </div>
</div>

<style>
.gallery-container {
    margin: 30px 0;
}

.gallery-container .row {
    display: flex;
    flex-wrap: wrap;
    margin: 0 -10px;
}

.gallery-item {
    padding: 0 10px;
    margin-bottom: 20px;
    display: flex;
}

.gallery-image-wrapper {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    width: 100%;
    padding-bottom: 100%; /* 1:1 Aspect Ratio - Quadratisch */
    background: #f5f5f5;
}

.gallery-image-wrapper:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
}

.gallery-image-wrapper .gallery-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.gallery-image-wrapper:hover .gallery-image {
    transform: scale(1.05);
}

/* Desktop: 3 Spalten */
@media (min-width: 992px) {
    .gallery-item {
        flex: 0 0 33.333%;
        max-width: 33.333%;
    }
}

/* Tablet: 2 Spalten */
@media (min-width: 768px) and (max-width: 991px) {
    .gallery-item {
        flex: 0 0 50%;
        max-width: 50%;
    }
}

/* Mobile: 1 Spalte */
@media (max-width: 767px) {
    .gallery-item {
        flex: 0 0 100%;
        max-width: 100%;
    }
    
    .gallery-image-wrapper {
        padding-bottom: 100%; /* Auch auf Mobile quadratisch */
    }
}

/* Modal Styling */
#imageModal-{{ $gallery }} .modal-dialog {
    margin: 30px auto;
}

#imageModal-{{ $gallery }} .modal-body {
    padding: 0;
}

#imageModal-{{ $gallery }} .modal-body img {
    max-height: 80vh;
    width: auto;
    margin: 0 auto;
}
</style>

<script>
(function() {
    var galleryId = '{{ $gallery }}';
    var images = [
        {{- range $index, $image := $imageList -}}
        {{- if $index -}},{{- end -}}
        "{{ printf "%s%s" $path (trim $image " ") | relURL }}"
        {{- end -}}
    ];
    var currentIndex = 0;
    
    // Handle image clicks
    $('#gallery-' + galleryId + ' .gallery-image').click(function() {
        currentIndex = parseInt($(this).data('image-index'));
        updateModalImage();
    });
    
    // Navigation buttons
    $('#prevBtn-' + galleryId).click(function() {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        updateModalImage();
    });
    
    $('#nextBtn-' + galleryId).click(function() {
        currentIndex = (currentIndex + 1) % images.length;
        updateModalImage();
    });
    
    // Keyboard navigation
    $('#imageModal-' + galleryId).on('shown.bs.modal', function () {
        $(document).on('keydown.gallery', function(e) {
            if (e.keyCode == 37) { // Left arrow
                $('#prevBtn-' + galleryId).click();
            } else if (e.keyCode == 39) { // Right arrow
                $('#nextBtn-' + galleryId).click();
            } else if (e.keyCode == 27) { // Escape
                $('#imageModal-' + galleryId).modal('hide');
            }
        });
    });
    
    $('#imageModal-' + galleryId).on('hidden.bs.modal', function () {
        $(document).off('keydown.gallery');
    });
    
    function updateModalImage() {
        $('#modalImage-' + galleryId).attr('src', images[currentIndex]);
    }
})();
</script>
{{- end -}}
