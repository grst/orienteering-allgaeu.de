{{ $gallery := .Get "gallery" }}
{{ $images := .Get "images" }}
{{ $path := .Get "path" | default "/img/posts/" }}

<!-- Gallery Container -->
<div class="gallery-container" id="gallery-{{ $gallery }}">
    <div class="row">
        {{ range $index, $image := split $images "," }}
        {{ $image := trim $image " " }}
        <div class="col-md-4 col-sm-6 col-xs-12 gallery-item">
            <div class="gallery-image-wrapper">
                <img src="{{ $path }}{{ $image }}" 
                     alt="Galerie Bild {{ add $index 1 }}"
                     class="gallery-image img-responsive"
                     data-toggle="modal" 
                     data-target="#imageModal-{{ $gallery }}"
                     data-image-src="{{ $path }}{{ $image }}"
                     data-image-index="{{ $index }}">
            </div>
        </div>
        {{ end }}
    </div>
</div>

<!-- Modal for full size images -->
<div class="modal fade" id="imageModal-{{ $gallery }}" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Galerie</h4>
            </div>
            <div class="modal-body text-center">
                <img id="modalImage-{{ $gallery }}" src="" class="img-responsive center-block" alt="Vergrößertes Bild">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" id="prevBtn-{{ $gallery }}">← Vorheriges</button>
                <button type="button" class="btn btn-default" id="nextBtn-{{ $gallery }}">Nächstes →</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Schließen</button>
            </div>
        </div>
    </div>
</div>

<style>
.gallery-container {
    margin: 20px 0;
}

.gallery-item {
    margin-bottom: 15px;
}

.gallery-image-wrapper {
    position: relative;
    overflow: hidden;
    border-radius: 5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.gallery-image-wrapper:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.gallery-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.gallery-image:hover {
    transform: scale(1.05);
}

@media (max-width: 768px) {
    .gallery-image {
        height: 150px;
    }
}
</style>

<script>
(function() {
    var galleryId = '{{ $gallery }}';
    var images = [{{ range $index, $image := split $images "," }}{{ if $index }},{{ end }}"{{ $path }}{{ trim $image " " }}"{{ end }}];
    var currentIndex = 0;
    
    // Handle image clicks
    $('#gallery-' + galleryId + ' .gallery-image').click(function() {
        currentIndex = parseInt($(this).data('image-index'));
        updateModalImage();
    });
    
    // Navigation buttons
    $('#prevBtn-' + galleryId).click(function() {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        updateModalImage();
    });
    
    $('#nextBtn-' + galleryId).click(function() {
        currentIndex = (currentIndex + 1) % images.length;
        updateModalImage();
    });
    
    // Keyboard navigation
    $('#imageModal-' + galleryId).on('shown.bs.modal', function () {
        $(document).on('keydown.gallery', function(e) {
            if (e.keyCode == 37) { // Left arrow
                $('#prevBtn-' + galleryId).click();
            } else if (e.keyCode == 39) { // Right arrow
                $('#nextBtn-' + galleryId).click();
            } else if (e.keyCode == 27) { // Escape
                $('#imageModal-' + galleryId).modal('hide');
            }
        });
    });
    
    $('#imageModal-' + galleryId).on('hidden.bs.modal', function () {
        $(document).off('keydown.gallery');
    });
    
    function updateModalImage() {
        $('#modalImage-' + galleryId).attr('src', images[currentIndex]);
    }
})();
</script>
